<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Degrowth London - Interactive Vision</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&display=swap"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Questrial:wght@400&display=swap"
            rel="stylesheet"
        />
        <style>
            @font-face {
                font-family: "QuestaSansLight";
                src:
                    url("/assets/fonts/questa_sans_light-webfont.woff2")
                        format("woff2"),
                    url("/assets/fonts/questa_sans_light-webfont.woff")
                        format("woff");
                font-weight: normal;
                font-style: normal;
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Questrial", "Raleway", sans-serif;
                background: #1a1a1a;
                overflow: hidden;
                user-select: none;
            }

            .visual-novel-container {
                position: relative;
                width: 100vw;
                height: 100vh;
                cursor: grab;
            }
            .visual-novel-container.dragging {
                cursor: grabbing;
            }

            .background-container {
                position: absolute;
                width: 120%;
                height: 120%;
                top: -10%;
                left: -10%;
                transition: transform 0.3s ease-out;
            }
            .background-image {
                width: 100%;
                height: 100%;
                object-fit: cover;
                background: url("market-street.jpg") center/cover;
            }

            .interactive-points {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
            }
            .point {
                position: fixed;
                width: 30px;
                height: 30px;
                background: transparent;
                border: 2.25px dashed #e8e8e8;
                border-radius: 50%;
                cursor: pointer;
                pointer-events: all;
                transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                z-index: 10;
            }

            .point:hover {
                border-color: #f9c1ce;
                box-shadow: 0 0 15px rgba(249, 193, 206, 0.4);
                transform: scale(1.1);
            }

            .point.selected {
                background: rgba(157, 110, 109, 0.3);
                border-color: #f9c1ce;
            }

            /* Connection lines between points */
            .connection-lines {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 2;
            }

            .simple-line {
                position: absolute;
                background: #9d6e6d;
                opacity: 0.8;
                pointer-events: none;
                border-radius: 2px;
            }

            @keyframes pulse {
                0%,
                100% {
                    transform: translate(-50%, -50%) scale(1);
                    opacity: 0.9;
                }
                50% {
                    transform: translate(-50%, -50%) scale(1.3);
                    opacity: 1;
                }
            }

            /* Improved dialogue panel */
            .dialogue-panel {
                position: fixed;
                top: 0;
                right: 0;
                width: 450px;
                height: 100vh;
                background: rgba(8, 12, 8, 0.75);
                backdrop-filter: blur(20px);
                border-left: 3px solid rgba(125, 19, 58, 0.3);
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.5s ease-out;
                z-index: 1000;
            }
            .dialogue-panel.visible {
                opacity: 1;
                transform: translateX(0);
            }

            .dialogue-content {
                height: 100%;
                display: flex;
                flex-direction: column;
            }

            .dialogue-header {
                padding: 25px;
                border-bottom: 2px solid rgba(125, 19, 58, 0.2);
                /* background: rgba(5, 8, 5, 0.7); */
            }

            .location-title {
                color: #f9c1ce;
                font-size: 1.3em;
                font-weight: bold;
                margin-bottom: 8px;
                text-transform: uppercase;
                letter-spacing: 1px;
            }
            .location-subtitle {
                color: #7d133a;
                font-size: 0.95em;
                font-style: italic;
            }

            .dialogue-scroll-area {
                flex: 1;
                position: relative;
                overflow: hidden;
            }
            .dialogue-text-container {
                height: 100%;
                overflow-y: auto;
                padding: 25px;
                padding-bottom: 80px;
            }

            /* Enhanced scrollbar */
            .dialogue-text-container::-webkit-scrollbar {
                width: 8px;
            }
            .dialogue-text-container::-webkit-scrollbar-track {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 4px;
            }
            .dialogue-text-container::-webkit-scrollbar-thumb {
                background: rgba(0, 255, 136, 0.7);
                border-radius: 4px;
            }
            .dialogue-text-container::-webkit-scrollbar-thumb:hover {
                background: rgba(0, 255, 136, 0.9);
            }

            .dialogue-entry {
                margin-bottom: 25px;
                line-height: 1.7;
            }
            .dialogue-speaker {
                color: #f9c1ce;
                font-weight: bold;
                margin-bottom: 8px;
                font-size: 0.9em;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            .dialogue-text {
                color: blue;
                font-size: 1.05em;
            }

            .section-text {
                color: #fdf2f5;
                font-size: 1.2em;
                line-height: 1.65;
                margin-bottom: 18px;
            }
            .highlight-text {
                color: #f9c1ce;
                /* font-weight: bold; */
                text-decoration: underline dotted;
            }

            /* Enhanced gradient fade */
            .dialogue-scroll-area::after {
                content: "";
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: 60px;
                background: linear-gradient(transparent, rgba(5, 8, 5, 0.96));
                pointer-events: none;
                z-index: 10;
            }

            /* Improved dialogue options */
            .dialogue-options {
                padding: 25px;
                border-top: 2px solid rgba(rgba(219, 192, 145, 0.2));
                background: rgba(5, 8, 5, 0.95);
            }
            .dialogue-option {
                display: block;
                width: 100%;
                background: transparent;
                border: none;
                color: #e8e8e8;
                padding: 15px 18px;
                margin-bottom: 12px;
                text-align: left;
                cursor: pointer;
                transition: all 0.3s ease;
                border-radius: 6px;
                font-family: inherit;
                font-size: 1em;
                line-height: 1.5;
            }
            .dialogue-option:hover {
                background: rgba(249, 193, 206, 0.7);
                /* border-color: rgba(249, 193, 206, 0.7); */
                color: #fff;
            }
            .dialogue-option:active {
                transform: translateX(3px) translateY(1px);
            }

            .option-number {
                color: #e8e8e8;
                font-weight: bold;
                margin-right: 10px;
                font-size: 1.1em;
            }

            /* Help overlay */
            .help-overlay {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(157, 110, 109, 0.95);
                backdrop-filter: blur(15px);
                border-radius: 16px;
                padding: 30px;
                z-index: 1001;
                transition: all 0.4s ease;
                border: 2px solid rgba(217, 195, 194, 0.5);
                min-width: 600px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            }

            .help-overlay.hidden {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
                pointer-events: none;
            }

            .help-close {
                position: absolute;
                top: 5px;
                right: 15px;
                background: none;
                border: none;
                color: #ece1e0;
                font-size: 35px;
                cursor: pointer;
                transition: color 0.2s ease;
            }

            .help-close:hover {
                color: pink;
            }

            .help-item {
                display: flex;
                align-items: center;
                margin-bottom: 16px;
                color: #ece1e0;
                font-size: 1.1em;
            }

            .help-item:last-child {
                margin-bottom: 0;
            }

            .help-icon {
                width: 28px;
                height: 28px;
                margin-right: 16px;
                flex-shrink: 0;
            }

            /* Mobile responsive */
            @media (max-width: 768px) {
                .dialogue-panel {
                    width: 100%;
                }
                .ui-overlay {
                    top: 15px;
                    left: 15px;
                    font-size: 0.85em;
                    padding: 12px;
                }
                .point {
                    width: 35px;
                    height: 35px;
                }
                .dialogue-text-container {
                    padding: 20px;
                }
                .dialogue-options {
                    padding: 20px;
                }
                .dialogue-header {
                    padding: 20px;
                }
            }

            @media (max-width: 1024px) and (min-width: 769px) {
                .dialogue-panel {
                    width: 400px;
                }
            }

            /* Dialogue Header Controls */
            .dialogue-header {
                position: relative;
                padding-right: 120px;
            }

            .dialogue-header-controls {
                position: absolute;
                top: 10px;
                right: 15px;
                display: flex;
                gap: 12px;
                z-index: 10;
            }

            .header-control {
                background: none;
                border: none;
                cursor: pointer;
                padding: 6px;
                border-radius: 4px;
                transition: background 0.2s ease;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .header-control:hover {
                background: rgba(217, 195, 194, 0.2);
            }

            .header-control svg {
                width: 20px;
                height: 20px;
                fill: #ece1e0;
                stroke: #ece1e0;
            }

            .text-speed-control {
                color: #ece1e0;
                font-size: 12px;
                font-weight: 500;
                min-width: 50px;
                text-align: center;
            }

            /* High contrast mode styles */
            body.high-contrast {
                /* filter: contrast(150%) brightness(120%); */
            }

            body.high-contrast .dialogue-panel {
                background: rgba(26, 26, 26, 1);
                border-color: #ffffff;
            }

            body.high-contrast .dialogue-option {
                background: rgba(51, 51, 51, 0.2);
                border-color: #ffffff;
            }

            body.high-contrast .dialogue-option:hover {
                background: rgba(51, 51, 51, 0.4);
            }

            body.high-contrast .section-text {
                color: #ffffff;
            }

            body.high-contrast .help-overlay {
                background: rgba(0, 0, 0, 0.95);
                border-color: #f2f2f2;
            }

            body.high-contrast .help-item {
                color: #ffffff;
            }

            body.high-contrast .header-control svg {
                fill: #ffffff;
                stroke: #ffffff;
            }

            body.high-contrast .text-speed-control {
                color: #ffffff;
            }
        </style>
    </head>
    <body>
        <div class="visual-novel-container" id="container">
            <div class="background-container" id="backgroundContainer">
                <div class="background-image" id="backgroundImage"></div>
            </div>
            <div class="connection-lines" id="connectionLines">
                <!-- Simple visible lines between points -->
                <div
                    class="simple-line"
                    style="
                        left: 25%;
                        top: 35%;
                        width: 35%;
                        height: 3px;
                        transform: rotate(-15deg);
                        transform-origin: 0 0;
                    "
                ></div>
                <div
                    class="simple-line"
                    style="
                        left: 25%;
                        top: 35%;
                        width: 25%;
                        height: 3px;
                        transform: rotate(30deg);
                        transform-origin: 0 0;
                    "
                ></div>
                <div
                    class="simple-line"
                    style="
                        left: 60%;
                        top: 20%;
                        width: 20%;
                        height: 3px;
                        transform: rotate(70deg);
                        transform-origin: 0 0;
                    "
                ></div>
                <div
                    class="simple-line"
                    style="
                        left: 45%;
                        top: 50%;
                        width: 35%;
                        height: 3px;
                        transform: rotate(-20deg);
                        transform-origin: 0 0;
                    "
                ></div>
                <div
                    class="simple-line"
                    style="
                        left: 45%;
                        top: 50%;
                        width: 15%;
                        height: 3px;
                        transform: rotate(60deg);
                        transform-origin: 0 0;
                    "
                ></div>
                <div
                    class="simple-line"
                    style="
                        left: 75%;
                        top: 65%;
                        width: 8%;
                        height: 3px;
                        transform: rotate(-70deg);
                        transform-origin: 0 0;
                    "
                ></div>
            </div>
            <div class="interactive-points" id="interactivePoints"></div>

            <!-- Enhanced dialogue panel -->
            <div class="dialogue-panel" id="dialoguePanel">
                <div class="dialogue-content">
                    <div class="dialogue-header">
                        <div class="dialogue-header-controls">
                            <button
                                class="header-control text-speed-control"
                                id="textSpeedToggle"
                            >
                                Relaxed
                            </button>
                            <button class="header-control" id="contrastToggle">
                                <svg
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <circle cx="12" cy="12" r="5" />
                                    <path
                                        d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                                    />
                                </svg>
                            </button>
                        </div>
                        <div class="location-title" id="locationTitle">
                            Degrowth London
                        </div>
                        <div class="location-subtitle" id="locationSubtitle">
                            A Vision for Sustainable Community
                        </div>
                    </div>
                    <div class="dialogue-scroll-area">
                        <div
                            class="dialogue-text-container"
                            id="dialogueTextContainer"
                        >
                            <div class="dialogue-entry">
                                <div class="dialogue-speaker">
                                    Welcome Explorer
                                </div>
                                <div class="section-text">
                                    You've entered a reimagined London - a city
                                    transformed by
                                    <span class="highlight-text"
                                        >degrowth principles</span
                                    >
                                    where community, sustainability, and
                                    wellbeing take priority over endless growth.
                                </div>
                                <div class="section-text">
                                    This vibrant market street represents just
                                    one corner of a city where
                                    <span class="highlight-text"
                                        >democracy flows from the
                                        grassroots</span
                                    >, energy is community-owned, education
                                    happens in living ecosystems, food is
                                    locally grown, housing serves everyone, and
                                    transport connects rather than divides.
                                </div>
                                <div class="section-text">
                                    Click the
                                    <span class="highlight-text"
                                        >glowing green points</span
                                    >
                                    around the scene to explore different
                                    aspects of this transformed society.
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="dialogue-options" id="dialogueOptions">
                        <button
                            class="dialogue-option"
                            onclick="hideDialogue()"
                        >
                            <span class="option-number">1.</span>Begin exploring
                            this new London...
                        </button>
                    </div>
                </div>
            </div>

            <!-- Help overlay with SVG icons -->
            <div class="help-overlay" id="helpOverlay">
                <button class="help-close" id="helpClose">×</button>
                <div class="help-item">
                    <svg class="help-icon" viewBox="0 0 24 24" fill="none">
                        <path
                            d="M8 13V16L12 12L8 8V11H2V13H8Z"
                            fill="#ece1e0"
                        />
                        <circle cx="16" cy="8" r="2" fill="#d9c3c2" />
                        <path
                            d="M14 6C14 4.89 14.89 4 16 4S18 4.89 18 6"
                            stroke="#c5a6a5"
                            stroke-width="1"
                        />
                    </svg>
                    <span>Drag to explore the market</span>
                </div>
                <div class="help-item">
                    <svg class="help-icon" viewBox="0 0 24 24" fill="none">
                        <circle
                            cx="12"
                            cy="12"
                            r="8"
                            stroke="#9d6e6d"
                            stroke-width="2"
                            fill="none"
                        />
                        <circle
                            cx="12"
                            cy="12"
                            r="3"
                            fill="#00ff88"
                            opacity="0.6"
                        />
                        <circle cx="12" cy="12" r="1" fill="#ece1e0" />
                    </svg>
                    <span>Click points to learn</span>
                </div>
                <div class="help-item">
                    <svg class="help-icon" viewBox="0 0 24 24" fill="none">
                        <rect
                            x="6"
                            y="2"
                            width="12"
                            height="20"
                            rx="3"
                            ry="3"
                            stroke="#b18988"
                            stroke-width="2"
                            fill="rgba(217, 195, 194, 0.3)"
                        />
                        <rect
                            x="8"
                            y="18"
                            width="8"
                            height="1"
                            rx="0.5"
                            fill="#895353"
                        />
                        <rect
                            x="9"
                            y="5"
                            width="6"
                            height="10"
                            rx="1"
                            fill="rgba(236, 225, 224, 0.2)"
                        />
                    </svg>
                    <span>Mobile friendly</span>
                </div>

                <!-- Spiral Logo -->
                <div style="text-align: center; margin-top: 20px; opacity: 1">
                    <svg
                        width="90"
                        height="100"
                        viewBox="0 0 100 100"
                        fill="#d9c3c2"
                    >
                        <g
                            clip-path="url(#d55aff93-61e1-465a-a206-98ba59959893_comp-lcymn9or)"
                        >
                            <path
                                d="M46.773 72.23c-.476.446-1.14 1.438-1.597 2.454-.461 1.015-.684 2.062-.64 3.113a5.455 5.455 0 0 0 .987 2.933c.606.875 1.446 1.57 2.875 2.012 1.434.442 2.672.406 3.77.211 1.094-.191 2.05-.558 2.836-1.121a5.38 5.38 0 0 0 1.8-2.18c.41-.886.633-1.906.688-2.937.051-1.031-.07-1.965-.375-2.867a8.128 8.128 0 0 0-1.449-2.567c-.66-.808-1.5-1.558-2.52-2.25a18.535 18.535 0 0 0-3.25-1.761c-1.03-.43-1.789-.59-2.558-.598a6.667 6.667 0 0 0-2.313.394 9.546 9.546 0 0 0-2.285 1.204 13.596 13.596 0 0 0-2.14 1.882 8.883 8.883 0 0 0-1.536 2.235 8.603 8.603 0 0 0-.754 2.539 10.78 10.78 0 0 0-.003 2.816c.125.977.367 1.996.71 2.977.34.98.754 1.851 1.254 2.648a10.892 10.892 0 0 0 1.735 2.14 10.752 10.752 0 0 0 2.207 1.63 11.89 11.89 0 0 0 2.633 1.074c.937.266 1.902.414 2.879.453.98.035 1.972-.043 2.976-.234a15.648 15.648 0 0 0 3.027-.914 19.356 19.356 0 0 0 3-1.575 19.462 19.462 0 0 0 2.61-1.968 13.908 13.908 0 0 0 1.957-2.164 9.804 9.804 0 0 0 1.262-2.336c.296-.801.464-1.625.496-2.797.027-1.172-.157-2.672-.582-4.149a15.394 15.394 0 0 0-2.032-4.297c-.93-1.375-2.109-2.68-3.543-3.886a24.732 24.732 0 0 0-4.863-3.18c-1.742-.867-3.363-1.367-4.969-1.562a13.666 13.666 0 0 0-4.722.234 16.59 16.59 0 0 0-4.485 1.758 22.77 22.77 0 0 0-4.097 2.984c-1.262 1.152-2.29 2.367-3.09 3.652a13.527 13.527 0 0 0-1.695 4.09c-.329 1.438-.422 2.946-.286 4.528.141 1.578.512 3.23 1.051 4.765.535 1.535 1.211 2.844 2.07 4.051a17.264 17.264 0 0 0 3.149 3.324c1.234 1.008 2.652 1.914 4.258 2.723a33.51 33.51 0 0 0 5.027 2.016c1.637.507 2.98.78 4.313.918 1.328.136 2.644.132 3.945-.012a18.922 18.922 0 0 0 3.848-.836c1.27-.414 2.52-.961 3.894-1.711a33.608 33.608 0 0 0 4.031-2.602 23.979 23.979 0 0 0 3.305-2.996 18.83 18.83 0 0 0 2.422-3.289c.66-1.144 1.176-2.336 1.605-3.883.43-1.543.61-3.425.41-5.332-.199-1.902-.785-3.824-1.765-5.757-.977-1.93-2.348-3.868-4.121-5.813-1.77-1.941-3.95-3.89-6.211-5.582-2.266-1.691-4.363-2.902-6.48-3.762-2.118-.86-4.25-1.363-6.383-1.508a18.57 18.57 0 0 0-6.364.688c-2.105.598-4.175 1.574-6.144 2.86a33.777 33.777 0 0 0-5.36 4.304C29.59 61 28.2 62.738 27.06 64.641a22.413 22.413 0 0 0-2.57 6.199c-.56 2.234-.778 4.64-.645 7.039.136 2.398.593 4.598 1.363 6.687a24.74 24.74 0 0 0 3.137 5.907c1.32 1.843 2.89 3.554 4.683 5.129 1.793 1.57 3.797 2.996 5.47 3.972 1.667.973 2.991 1.508 4.468 1.895 1.48.386 3.097.617 4.828.664a25.864 25.864 0 0 0 5.477-.461c1.914-.36 3.882-.95 6-1.805a59.236 59.236 0 0 0 6.117-2.902 43.931 43.931 0 0 0 5.16-3.29 31.525 31.525 0 0 0 4.086-3.616 25.99 25.99 0 0 0 3.039-3.887 25.12 25.12 0 0 0 2.008-3.852 19.89 19.89 0 0 0 1.172-3.93c.253-1.335.359-2.71.312-4.124a22.197 22.197 0 0 0-.613-4.375 32.51 32.51 0 0 0-1.364-4.36 30.435 30.435 0 0 0-1.898-3.988 28.553 28.553 0 0 0-2.43-3.594 30.016 30.016 0 0 0-3.046-3.289 43.968 43.968 0 0 0-3.833-3.187 39.85 39.85 0 0 0-4.328-2.785 37.476 37.476 0 0 0-4.77-2.231 39.53 39.53 0 0 0-4.866-1.523c-1.453-.352-2.594-.57-3.805-.727a22.17 22.17 0 0 0-3.945-.148c-1.43.07-3.004.3-4.754.726-1.75.426-3.696 1.078-5.68 1.89a48.423 48.423 0 0 0-6.176 3.032 30.837 30.837 0 0 0-6.414 4.984c-2.07 2.094-3.922 4.727-5.414 7.98-1.496 3.259-2.527 7.208-2.957 11.177-.426 3.972-.355 7.23.106 10.172.46 2.94 1.277 5.597 2.414 7.996a30.347 30.347 0 0 0 4.25 6.578 42.412 42.412 0 0 0 5.48 5.39 33.125 33.125 0 0 0 5.856 3.856 34.619 34.619 0 0 0 6.664 2.586 38.214 38.214 0 0 0 7.543 1.258c2.644.18 5.414.093 8.199-.223 2.785-.32 5.277-.719 7.484-1.2 2.207-.48 4.211-1.073 6.102-1.831 1.89-.754 3.746-1.703 5.66-2.883a65.093 65.093 0 0 0 5.664-3.98c1.71-1.348 2.863-2.47 3.902-3.72a24.392 24.392 0 0 0 2.774-4.167 30.578 30.578 0 0 0 2.086-5c.582-1.809 1.054-3.766 1.43-5.953a53.95 53.95 0 0 0 .722-6.543c.098-2.114.05-4.106-.137-5.965a29.395 29.395 0 0 0-.988-5.196c-.465-1.597-1.062-3.058-2.55-5.718-1.489-2.66-3.923-6.348-6.594-9.598-2.672-3.25-5.598-6.031-8.817-8.293a35.155 35.155 0 0 0-10.605-5.07c-3.864-1.106-8.078-1.57-11.211-1.516-3.133.05-4.985.258-6.914.598-1.926.34-3.93.82-6.008 1.453a60.818 60.818 0 0 0-6.461 2.387 76.596 76.596 0 0 0-6.543 3.222c-2.012 1.117-3.625 2.145-5.152 3.25a40.88 40.88 0 0 0-4.282 3.578 36.481 36.481 0 0 0-3.668 4.106c-1.117 1.457-2.117 3.012-3.554 5.828-1.438 2.813-2.914 6.617-3.758 10.18-.848 3.562-1.09 6.984-.79 10.367.298 3.383 1.055 6.824 2.188 10.441 1.133 3.617 3.254 7.14 5.074 9.848 1.817 2.707 3.325 1.883 2.286-.004 0 0-1.575-4.035-3.254-7.496-1.68-3.461-3.223-6.625-4.145-9.797a26.336 26.336 0 0 1-.957-9.742c.29-3.356 1.238-6.914 2.922-10.766 1.684-3.851 2.578-5.426 3.59-6.91a33.699 33.699 0 0 1 3.363-4.191 38.533 38.533 0 0 1 4-3.676 44.909 44.909 0 0 1 4.574-3.188c1.614-.988 3.946-2.242 6.196-3.308a65.316 65.316 0 0 1 6.527-2.696 52.961 52.961 0 0 1 6.07-1.738 45.075 45.075 0 0 1 5.602-.886c1.785-.16 6.184-.149 10.195.515 4.012.664 7.68 1.942 11.028 3.797 3.351 1.852 6.414 4.242 9.21 7.133 2.801 2.89 5.36 6.25 7.708 10.031 2.347 3.781 3.003 5.098 3.539 6.559.535 1.46.945 3.058 1.226 4.793.278 1.73.422 3.597.422 5.597a48.9 48.9 0 0 1-.441 6.375c-.297 2.25-.692 4.278-1.192 6.149a33.135 33.135 0 0 1-1.816 5.18 25.018 25.018 0 0 1-2.465 4.324 21.975 21.975 0 0 1-3.133 3.52c-1.16 1.042-3.324 2.687-5.297 4.034-1.968 1.348-3.812 2.43-5.636 3.293a33.585 33.585 0 0 1-5.727 2.09c-2.031.543-4.293.984-6.883 1.371-2.594.383-5.394.653-8.078.649a38.833 38.833 0 0 1-7.672-.754 35.094 35.094 0 0 1-6.84-2.125 31.872 31.872 0 0 1-5.882-3.285c-1.793-1.27-3.801-3-5.602-4.856-1.805-1.855-3.375-3.863-4.68-6.062a27.605 27.605 0 0 1-3-7.309c-.687-2.687-1.015-5.672-.953-8.988.063-3.32.707-7.711 1.88-11.352 1.171-3.64 2.765-6.605 4.648-8.996a27.805 27.805 0 0 1 6.097-5.746 39.7 39.7 0 0 1 6.172-3.473c1.93-.87 4-1.683 5.844-2.246 1.844-.562 3.492-.91 4.976-1.082a21.464 21.464 0 0 1 4.059-.094c1.238.09 2.39.27 3.496.497 1.106.23 2.879.68 4.57 1.238a37.12 37.12 0 0 1 9.235 4.558 41.763 41.763 0 0 1 3.992 3.067c1.266 1.097 2.293 2.105 3.23 3.172a27.8 27.8 0 0 1 2.547 3.386 28.605 28.605 0 0 1 2.032 3.774 31.94 31.94 0 0 1 1.52 4.172c.425 1.457.73 2.91.878 4.308a18.367 18.367 0 0 1-.871 7.922 22.681 22.681 0 0 1-1.66 3.723 25.413 25.413 0 0 1-2.621 3.82 28.072 28.072 0 0 1-3.66 3.645 38.016 38.016 0 0 1-4.715 3.34 55.258 55.258 0 0 1-5.844 3.05c-2.14.973-4.102 1.707-6.012 2.207-1.906.5-3.75.782-5.504.86-1.754.078-3.406-.028-4.926-.301-1.523-.273-2.898-.7-4.109-1.254-1.207-.555-3.305-1.863-5.203-3.312a31.938 31.938 0 0 1-5.04-4.754 25.517 25.517 0 0 1-3.589-5.512 22.493 22.493 0 0 1-1.926-6.195 24.096 24.096 0 0 1-.039-6.914 21.53 21.53 0 0 1 1.906-6.348 23.962 23.962 0 0 1 3.563-5.395c1.43-1.648 3.066-3.148 4.871-4.507 1.805-1.364 3.8-2.559 5.816-3.383 2.016-.82 4.055-1.278 6.106-1.38 2.05-.097 4.113.157 6.172.759 2.058.605 4.113 1.554 6.152 2.851 2.035 1.301 4.453 3.227 6.461 5.14 2.012 1.915 3.613 3.813 4.817 5.696 1.207 1.88 2.023 3.738 2.457 5.57.437 1.832.503 3.641.203 5.426-.297 1.785-.7 2.953-1.243 4.082a17.083 17.083 0 0 1-2.046 3.254 21.337 21.337 0 0 1-2.91 2.992 29.187 29.187 0 0 1-3.825 2.735c-1.426.867-2.633 1.48-3.847 1.965a19.237 19.237 0 0 1-3.684 1.062 17.797 17.797 0 0 1-3.762.274 19.085 19.085 0 0 1-3.863-.528c-1.305-.312-3.188-.941-4.875-1.664-1.688-.723-3.188-1.543-4.5-2.453a18.074 18.074 0 0 1-3.379-3.008 14.875 14.875 0 0 1-2.285-3.55c-.586-1.278-1.094-2.926-1.375-4.493-.281-1.566-.336-3.05-.172-4.457a12.623 12.623 0 0 1 1.164-4.008c.61-1.261 1.441-2.464 2.5-3.601a22.107 22.107 0 0 1 3.73-3.164c1.36-.918 2.766-1.63 4.208-2.114a13.421 13.421 0 0 1 4.41-.726c1.496.008 3.015.289 4.558.867 1.543.574 3.352 1.57 4.907 2.672 1.55 1.105 2.847 2.305 3.89 3.578 1.047 1.274 1.852 2.606 2.414 3.984.563 1.375.887 2.786.985 4.207.093 1.422.023 2.168-.168 2.907a8.3 8.3 0 0 1-.934 2.176 11.57 11.57 0 0 1-1.629 2.078 16.871 16.871 0 0 1-2.285 1.941 20.002 20.002 0 0 1-2.816 1.68c-.97.472-1.934.836-2.887 1.09a13.06 13.06 0 0 1-2.824.43 11.583 11.583 0 0 1-2.73-.216 11.555 11.555 0 0 1-2.563-.824 10.195 10.195 0 0 1-2.18-1.347 9.715 9.715 0 0 1-1.75-1.829 11.444 11.444 0 0 1-1.312-2.296 14.87 14.87 0 0 1-.864-2.782 10.847 10.847 0 0 1-.23-2.695 8.043 8.043 0 0 1 .457-2.402 7.52 7.52 0 0 1 1.14-2.094c.497-.645 1.184-1.332 1.88-1.899.695-.57 1.39-1.02 2.085-1.343a6.53 6.53 0 0 1 2.047-.598 5.06 5.06 0 0 1 1.969.16c.644.184 1.902.79 2.96 1.442 1.063.652 1.93 1.343 2.606 2.066.68.723 1.172 1.469 1.492 2.227.32.757.481 1.527.477 2.304 0 .778-.172 1.723-.46 2.477-.29.75-.684 1.312-1.169 1.707-.484.394-1.078.644-1.816.75-.739.11-1.625.066-2.54-.129-.91-.191-1.144-.59-1.5-1.11-.359-.515-.605-.972-.761-1.456-.156-.48-.23-1.047-.195-1.75.035-.704.218-1.555.277-2.055.355-1.004-1.527-1.438-1.227-1.942Zm0 0"
                            ></path>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <script>
            const storyPoints = [
                {
                    x: 25,
                    y: 35, // Near the community gathering/market area
                    title: "Democracy",
                    subtitle: "",
                    sections: [
                        {
                            speaker: "",
                            text: "Built upon the foundations of true community power, democracy is formed from the people’s decisions, for the people. Governance is no longer dictated by distant politicians or corporate elites but shaped collectively by those who live and breathe their neighbourhoods everyday. Degrowth has reformed the bureaucratic political processes of the past, policy is now pro-active, initiated by residents to serve fellow residents. Citizens’ assemblies have been created in every community giving people the direct power to allocate resources, shape development and reclaim control over their own futures. London is no longer a playground for the super-rich, its streets, homes and open spaces belong to the people once more.",
                        },
                        {
                            speaker: "",
                            text: "We reject the concentration of hierarchical power in the hands of the few. Instead, we embrace sociocracy and ‘decision-making’ methods to create policy where every voice matters and every decision is built upon collective consent. Top-downpower structures have been replaced by grassroots assemblies in which autonomous social circles established by locals interlink across neighbourhoods to cover policy topics relevant to their people and area. This bottom-up approache stablishes the equality of individuals. Democracy is not ‘one man, one vote’ but rather a group of individuals discussing together until a consensus has been met. These local assemblies have transformed the two-party political binary and first-past-the-post system which historically served a capitalist hierarchy.",
                        },
                        {
                            speaker: "",
                            text: "The age of majority which restricts the voting age and political input from those under 16 years of age has been overturned. All people of all ages and backgrounds are encouraged to participate in policy-making and political discussion. Everyone is listened to; even the youngest’s dreams are involved in future decisions. Politics holds a positive and joyous public perception. Community policy is trusted and valued, and the decision-making process is respected, even enjoyable. Political debate has turned into community conversation which is less binary, more open, personal and flowing between neighbours and friends who listen and catch-up with each other during monthlycitizens’ assemblies.",
                        },
                        {
                            speaker: "",
                            text: "In this world, power is not hoarded but shared, and disagreements are not battles but opportunities for dialogue, empathy and understanding. Decentralised community assemblies have the freedom to shape their own spheres, ensuring that democracy is not just an ideal but a lived reality in every corner of society. Degrowth is not about scarcity – it is about abundance in the things that truly matter: connection, community, and care. Because we have dismantled political systems of profit-driven destruction, we have cultivated spaces where people flourish and grow, where the earth is healed, and where justice is not an aspiration but a daily practice. Local action is not just a stepping stone, it is the heartbeat of sustainable transformation. Through these grassroots movements, we continue to build a world where everyone has a stake, where solidarity triumphs over division, and where the future is not dictated by markets but co-created and curated by the many.",
                        },
                    ],
                    options: [
                        {
                            text: "[Discuss an issue]",
                            section: 1,
                        },
                        { text: "[Join the assembly]", section: 3 },
                        { text: "[Cast a vote]", section: 2 },
                        { text: "[Explore somewhere else]", action: "close" },
                    ],
                },
                {
                    x: 60,
                    y: 20, // Near the rooftops with solar potential
                    title: "Energy",
                    subtitle: "",
                    sections: [
                        {
                            speaker: "",
                            text: "In this neighbourhood, everyone has access to affordable, renewable energy. Solar panels are dotted across rooftops and above car parks too. Our homes and workplaces have been built or retrofitted to a high standard, so people no longer have to worry about damp, mould and cold. Energy bills are lower too. Homes are heated with heat pumps or through heat networks, and everyone belongs to the local energy co-operative so we benefit from the energy we generate and use. There is a sense of collective responsibility and shared knowledge around energy.",
                        },
                        {
                            speaker: "",
                            text: "As energy prices rose, people became more conscious of their energy use. It also became clear that there was an issue of fairness, with those most affected being least able to pay, threatening health and wellbeing. In response, there was a groundswell of community action. Groups started to form to campaign for energy rights - a right to affordable energy for all to be able to meet their needs. These groups joined forces with environmental campaigners who were calling for a shift away from fossil fuels, a reduction in energy use, and greater energy independence. Eventually, the Mayor of London listened.",
                        },
                        {
                            speaker: "",
                            text: "A citizen’s assembly was formed to agree a way forward. They decided that an equitable energy allowance should be set. The wealthiest in London, who used the most energy, would reduce their consumption or be charged a premium for the extra energy they used. The funds from this premium would be used to retrofit and insulate London’s leakiest homes, improving living standards and wellbeing at the same time.",
                        },
                        {
                            speaker: "",
                            text: "Inspired by energy communities elsewhere in the UK, borough councils backed energy groups in the fight to change planning rules and energy policy to make it easier for neighbourhoods to build flexible, local renewable energy networks. These networks, like our energy cooperative, give people control of their local energy, with every member given a voice and decisions taken democratically. Any profits from the energy generated is reinvested in the community.",
                        },
                        {
                            speaker: "",
                            text: "There are still a number of challenges, with old infrastructure and limited grid capacity making it difficult to build community energy as fast as we’d like. People have started to work on sustainable supply chains in the UK and in Europe so that solar panels can be made ethically, without forced labour, and reduce harm to the environment but more work needs to be done. And while London has decided to tackle energy demand to meet climate goals and help with bills, energy demand from other sources, like AI and data centres, continues to grow, threatening progress. But people are seeing the benefits of a clean energy system, with local control and better homes, and the movement is growing.",
                        },
                    ],
                    options: [
                        { text: "Explore energy cooperatives", section: 3 },
                        { text: "Learn about fair distribution", section: 2 },
                        { text: "Understand community response", section: 1 },
                        { text: "[Explore somewhere else]", action: "close" },
                    ],
                },
                {
                    x: 75,
                    y: 65, // Near the educational/workshop areas
                    title: "Education",
                    subtitle: "Learning Ecosystems",
                    sections: [
                        {
                            speaker: "Living Classrooms",
                            text: "Places of education are ecosystems of learning not confined by four walls. They are dynamic learning communities woven into the natural and social worlds around them. Students are learning by doing, out there in the world. They immerse in hands-on activities, participating in local conservation projects, urban planning initiatives in cooperation with the local council and gain varied work experience with local B-corp businesses. Learning extends the classroom into spaces where students experience cooperation and conviviality and take on responsibility as eco-literate, compassionate change makers.",
                        },
                        {
                            speaker: "Hands-On Learning",
                            text: "Children practice autonomy by engaging in a range of decision-making processes. Sociocracy is practiced in and beyond classroom spaces; students vote for a larger library or allotment for growing vegetables for school lunches. Children access a range of such commons systems to cultivate fair resource sharing and the concept of stewardship. This cooperation is fostered from the first day of school, from early years and primary and beyond, with students tending to gardens or building model schools in teams. Students also collaborate through physical activity and sport involving team work; the value of cooperation is made explicit and the science behind the physical and mental health benefits are discovered. Through these activities students understand the interconnectedness of our world.",
                        },
                        {
                            speaker: "Student Democracy",
                            text: "Learning is multidisciplinary. Students make cross curricular links to cultivate synoptic thinking. In geography, they might collect water from a river and discover contaminants from a factory. They collaborate with students in economics who apply understanding of the commons as provisioning systems to reduce ecological degradation. Students observe that markets ruled by profit lead to ecological harm and work to lobby local councils for change. Budding healthcare professionals, scientists and ecological economists develop a scientific understanding of how the water contamination may impact our health and other life sustaining systems. Understanding food systems and their impact on the planet is part of the curricula across science, geography, PSHE and economics.",
                        },
                        {
                            speaker: "Interdisciplinary Approach",
                            text: "In the early years, children learn through immersion and wonder. Learning happens in biodiversity gardens, community spaces, and intergenerational settings. A typical day might begin with a morning circle where young learners practice mindfulness and develop communication skills through storytelling, listening circles, and intercultural exchanges that nurture empathy and understanding.",
                        },
                        {
                            speaker: "Transformative Higher Ed",
                            text: "In secondary school, mathematics is learned through practical problem-solving – measuring garden yields, understanding local resource distribution, and exploring patterns in nature. Science becomes a living inquiry, where children track local wildlife, understand food webs, and develop deep ecological literacy. Personal development programs focus on physical and mental health, financial and ecological literacy with an understanding of planetary ecosystems. Wilderness experiences cultivate systems thinking, teamwork, life skills, ecological understanding as well as resilience through survival challenges.",
                        },
                        {
                            speaker: "",
                            text: "Higher education becomes a platform for transformative learning and societal innovation. Universities are interdisciplinary research hubs that bring together diverse perspectives to address global challenges and work with local governments and business. Degree programs are designed around solving complex, real-world challenges in which students may design circular economic strategies or explore alternative governance models that prioritise collective wellbeing. They are incubators of regenerative solutions that prioritise planetary health and social equity. A learning space where age is no barrier, and knowledge is co-created across generations and cultures.",
                        },
                        {
                            speaker: "",
                            text: "Curricula across all levels of education are live and ever adapting to reflect human and ecological needs. Models incorporate human complexity and reciprocal behaviour. Models are qualitative; the role of care, reciprocity, and wellbeing is the foundation and empower and inspire equitable and sustainable imaginaries.",
                        },
                    ],
                    options: [
                        { text: "Discover hands-on learning", section: 1 },
                        { text: "Explore student democracy", section: 2 },
                        {
                            text: "Learn about interdisciplinary studies",
                            section: 3,
                        },
                        { text: "[Explore somewhere else]", action: "close" },
                    ],
                },
                {
                    x: 45,
                    y: 50, // Central market area with food vendors
                    title: "Food",
                    subtitle: "Local & Sustainable",
                    sections: [
                        {
                            speaker: "Green City",
                            text: "The city of London is much greener than the one today. Every block has a roof garden, and every windowsill has room for a mini herb or veg box. Green spaces are more common, bigger, surrounded by quieter roads to protect the wildlife, and with community gardens and workshops which act as knowledge exchange hubs. Having the space to grow your own food helps children and adults alike learn about the power of the soil.",
                        },
                        {
                            speaker: "Farmers Markets",
                            text: "Around each city quarter, is a farmers’ market. Although the UK cannot be totally self-sufficient, this is the first step to reform the current food system, to restore its resilience and improve its sustainability. Rather than supermarkets, these are the primary places to buy food. Human activities work with and are shaped by nature in a Degrowth society. Therefore, London has been reorganised around the values of being local, seasonal, and sustainable. These farmers and you, consumers, have a more direct relationship – you know where your food comes from, how it is produced, and how to prepare it with as little waste as possible. Buying more locally and directly from farmers not only supports the local economy and the farmers themselves but also promotes better quality and fairer produce. This is because fruit and vegetables which are grown in season are at their best during their time frame – they are fresher and more nutritious, as well as being cheaper and lower in associated carbon emissions than those transported across long(er) distances.",
                        },
                        {
                            speaker: "No plastic",
                            text: "At the farmers’ market none of the packaging is plastic, and it can all be returned to the farmer for reuse or recycled. This is part of the second step to restoring the resilience and sustainability of the food system. Some industrial processing would continue, such as the pasteurisation of dairy products (which would be on a smaller scale), drying, canning, and dehydrating. However, on the whole, consumers would wash, cut, cook, juice, and freeze what they buy. For example, making your own jam, made possible by being able to gather the berries even in the city. Reforming the cultures around work and poverty brings more time for everyone to get involved.",
                        },
                        {
                            speaker: "No processed foods",
                            text: "There is also no longer the need for the processing and marketing of food, especially meat – both cost wise, as well as impact wise. Consumers are not pressured to buy unnecessary products, especially environmentally damaging ones at vast and unethical quantities such as chicken. As a result, a greater share of the dollar is returned to our farmers, and nutrition, quality, and the value of food is returned to the consumer. Decreasing the amount of processing that goes into our food is a reduction in added salts, sugars, fats, preservatives etc. But with better quality products, these are unnecessary anyway.",
                        },
                        {
                            speaker: "Zero Waste",
                            text: "The third step is better waste management. Compost is a requirement to avoid any food waste going to landfill. It is collected, composted, and redistributed to the local farmers by the council as fertiliser for fields. No food is chucked out when it is perfectly edible but is redistributed to anyone who needs it. Without the pressure for supermarkets and farmers to make a profit and over-purchase, and with the knowledge and extra time on the hands of consumers to make wiser decisions, food is more accurately produced and accessible for all. The phrase ‘fugal abundance’ best captures this moment where the lifecycle of food is over much smaller distances, in smaller quantities, but inclusive of all households.",
                        },
                    ],
                    options: [
                        {
                            text: "[Look at the skyline]",
                            section: 1,
                        },
                        {
                            text: "[Look down the alley]",
                            section: 2,
                        },
                        {
                            text: "[Browse the fresh produce]",
                            section: 3,
                        },
                        {
                            text: "[Buy some food from the market]",
                            section: 4,
                        },
                        {
                            text: "[Throw the trash out]",
                            section: 5,
                        },
                        {
                            text: "[Explore somewhere else]",
                            action: "close",
                        },
                    ],
                },
                {
                    x: 80,
                    y: 30, // Near the housing/residential areas
                    title: "Housing",
                    subtitle: "Community Ownership",
                    sections: [
                        {
                            speaker: "Thriving Neighbourhoods",
                            text: "London is now a thriving hub of interweaving neighbourhoods where housing is plentiful and owned and managed by local residents in cooperation with the local authority. Our homes are beautiful, spacious, full of natural light and our neighbourhoods are full and public art that celebrates our diversity and heritage. We live in homes that support our whole humanity - our built environment helps our spiritual, emotional and intellectual selves grow.",
                        },
                        {
                            speaker: "Integrated Systems",
                            text: "Our housing operates synergistically with our transport and food systems. Public green andopen spaces encourage community and nature connection - community food growing schemes,hedgerows and fruit trees lining pathways through the heart of the city, canal systems andwetlands integrated into our neighbourhoods. Community space is integrated intoneighbourhoods and block; there’s free, sheltered and indoor space like fire pits with awnings orcommunal living rooms etc. There’s meeting spaces for community groups and hyper-localisedpublic services like libraries, medical centres, and places of worship.",
                        },
                        {
                            speaker: "Community Stewardship",
                            text: "Especially in large cities like London, traditional understandings of community and connection to nature were lost. But now housing is part of our stewardship of the earth we inhabit and a tangible part of creating community around us. We have collective responsibility for the places in which we live and London as a whole. We meet regularly to consult about how to manage our housing together and plan community gatherings with different roles harnessing everyone’s talents and capacity.",
                        },
                        {
                            speaker: "Policy Changes",
                            text: "Community groups and campaigns came together with local people across differences andmade the change happen. Instead of reactionary solutions and raw deals with corporationsleading to gentrification, the council supported. Instead of investing in development teams andpublic private partnerships they invested in large community engagement + tenant participationteams that learn how to effectively support residents + local businesses to steward + managetheir local areas. Compulsory purchase orders were issued against oligarch landlords and policynow bans absentee business owners holding data servers and empty office blocks and multipleholiday homes. Unique housing systems grew out of the heritage of each place - boaters andtourists and students and locals and immigrants. Self-build and retrofitting movements wereencouraged to thrive to uplift existing housing stock in line with planetary boundaries. (thinksolar punk + no demolition).",
                        },
                        {
                            speaker: "Diverse Communities",
                            text: "London’s systems support a national system change. Our housing supports a decentralisation ofthe economy - less brain-drain and stronger local connections - makes London less expensive +strengthens rural economies in return - and this is replicated in how London’s pockets interactwith each other. Housing and wider land rights campaigns came together with the right to roamand the right to grow necessarily coming forward as part of a more equitable stewardship of howwe inhabit space (think trespass and diggers).",
                        },
                        {
                            speaker: "",
                            text: "London’s neighbourhoods now house whole diverse intermixed communities, made up of people from all different classes, ethnic and religious backgrounds, ages and cultures. We have integrated specialised and supported housing for those who are more vulnerable, like supported temporary accommodation for care-leavers or refugees or the homeless, or a high supply of housing built for the needs of those who are disabled. There is plentiful short-term housing that is integrated into local neighbourhoods for example sustainable tourism and cultural exchange or student housing.",
                        },
                        {
                            speaker: "",
                            text: "Everything operates on a diversity of approaches and ownership and rental structures - buthousing structures are a lot more fluid. Communal and intergenerational housing is also thenorm, intentionally set up for community - a queering of the nuclear family and embracingextended family structures. This is often synergetic with nurseries or youth hostels withvolunteer schemes in homes for the elderly - creative studios in purpose built housingcommunities - or housing coops for groups of families and individuals that grow food together.",
                        },
                        {
                            speaker: "",
                            text: "Of course, we have ongoing challenges. We are learning how to retrieve building materials from sunken villages when the sea-levels rose and how to manage our housing supple for people fleeing from climate disaster in other parts of the world. We are learning to build houses of living trees from English Oaks and learning about limestone coral reefs that have become the foundations of Venice’s floating buildings. We are adapting and creating as we go.",
                        },
                    ],
                    options: [
                        {
                            text: "Learn about community stewardship",
                            section: 2,
                        },
                        { text: "Explore policy changes", section: 3 },
                        { text: "Discover diverse communities", section: 4 },
                        { text: "[Explore somewhere else]", action: "close" },
                    ],
                },
                {
                    x: 35,
                    y: 75, // Near the pedestrian walkways
                    title: "Transport",
                    subtitle: "People-Centred Mobility",
                    sections: [
                        {
                            speaker: "Reclaimed Streets",
                            text: "Pedestrians, bikes, and well-funded green public transport networks weave seamlessly around the city. The space which used to be sacrificed for private cars is given back to the people, opening out walkways which are safe and accessible for wheelchair users, children, and other accessibility needs. Birdsong is more varied, no longer needing to compete over the noise of the traffic. The air is cleaner, and wildflowers, trees, and gardens can bloom down the streets.",
                        },
                        {
                            speaker: "Natural Harmony",
                            text: "Roads specifically for rubbish lorries, delivery vans, and buses are carefully planned out to the essential points whilst avoiding main pedestrian hubs. Deliveries and rubbish collections, operating at a reduced rate as consumption and waste decreases, come only at specific times of the day, allowing for buses to be the main road users. These routes extend outside the city, ferrying people to their cars if they have one, which are kept in car parks that share their space with community gardens and parks. Cars which do exist outside the city are electric, and much smaller, taking the most practical and efficient form. The number of buses available has not needed to dramatically increase to accommodate the spike in users; rather intelligent time management, such as staggering school year groups’ leaving times, make use of the number of buses available.",
                        },
                        {
                            speaker: "Cycling Infrastructure",
                            text: "Cycle routes are no longer crammed to the side of the road, competing for attention and jostling to be ahead of the cars, but given the space to wheel safely through London on smooth, well-drained surfaces. These paths are separate from pedestrian walkways but are similar in the way they are lined with plants and trees. The lights which illuminate the cyclists are subtle to not disturb nature, but strategically placed to help guide the way. Traffic lights are rare – if any at all – since there is no need for external enforcement between bikes.",
                        },
                        {
                            speaker: "Transformation Process",
                            text: "Phasing cars out of the city was a challenging but rewarding process which took place simultaneously with bringing in more buses, training up drivers, creating more bike spaces – both parking and sharing, and incorporating cycling lessons into the school curriculum. With everyone given access to a bicycle or a motorised transport at bicycle-speed, cycling successfully replaced cars as the principal way of getting around the city. A participatory process was undertaken to co-design the new pedestrian, bike, and work-road routes, and nationalised rail (with no classes) and bus fares assured affordability in the place of the car. Transforming London’s old car-focused areas into green spaces, vegetable gardens, and parks was a collaborative project for local community groups including schools, community centres, and elderly homes. Bike hubs and workshops popped up in the place of petrol stations; wooden benches and colourful climbing frames in the place of roundabouts.",
                        },
                        {
                            speaker: "Time Freedom",
                            text: "A key consequence of the slowing down of transport and the removal of traffic is that time is given back to us, where we are not rushing off to complete more work, feeling compelled to make special trips, or cram a holiday. By removing the price tag from time, we create a more equitable society.",
                        },
                    ],
                    options: [
                        { text: "Explore reclaimed streets", section: 0 },
                        {
                            text: "Learn about cycling infrastructure",
                            section: 2,
                        },
                        { text: "Understand time freedom", section: 4 },
                        { text: "[Explore somewhere else]", action: "close" },
                    ],
                },
            ];

            const container = document.getElementById("container");
            const backgroundContainer = document.getElementById(
                "backgroundContainer",
            );
            const interactivePoints =
                document.getElementById("interactivePoints");
            const dialoguePanel = document.getElementById("dialoguePanel");
            const locationTitle = document.getElementById("locationTitle");
            const locationSubtitle =
                document.getElementById("locationSubtitle");
            const dialogueTextContainer = document.getElementById(
                "dialogueTextContainer",
            );
            const dialogueOptions = document.getElementById("dialogueOptions");
            const helpOverlay = document.getElementById("helpOverlay");
            const helpClose = document.getElementById("helpClose");

            let isDragging = false,
                startX = 0,
                startY = 0,
                currentX = 0,
                currentY = 0;
            let currentStoryPoint = null;
            let pointElements = [];
            let textSpeed = 1500; // milliseconds between paragraphs (default to medium)

            function initialize() {
                createInteractivePoints();
                setupEventListeners();
                showWelcomeMessage();
                updatePointPositions();
            }

            function createInteractivePoints() {
                storyPoints.forEach((point, index) => {
                    const pointElement = document.createElement("div");
                    pointElement.className = "point";
                    pointElement.dataset.index = index;
                    pointElement.addEventListener("click", () =>
                        showDialogue(point, pointElement),
                    );
                    document.body.appendChild(pointElement);
                    pointElements.push(pointElement);
                });
            }

            function setupEventListeners() {
                container.addEventListener("mousedown", startDrag);
                container.addEventListener("mousemove", drag);
                container.addEventListener("mouseup", endDrag);
                container.addEventListener("mouseleave", endDrag);
                container.addEventListener("touchstart", startDragTouch);
                container.addEventListener("touchmove", dragTouch);
                container.addEventListener("touchend", endDrag);

                // Auto-close intro popup when clicking on map or interacting with points
                container.addEventListener("click", (e) => {
                    // Only close if the welcome message is showing and user clicks on map area
                    if (
                        dialoguePanel.classList.contains("visible") &&
                        currentStoryPoint === null &&
                        !dialoguePanel.contains(e.target) &&
                        !e.target.closest(".point")
                    ) {
                        hideDialogue();
                    }
                });

                // Auto-close intro popup when any point is clicked
                document.addEventListener("click", (e) => {
                    if (
                        e.target.closest(".point") &&
                        dialoguePanel.classList.contains("visible") &&
                        currentStoryPoint === null
                    ) {
                        hideDialogue();
                    }
                });

                helpClose.addEventListener("click", () => {
                    helpOverlay.classList.add("hidden");
                });
                container.addEventListener("contextmenu", (e) =>
                    e.preventDefault(),
                );

                // Text speed toggle
                const textSpeedToggle =
                    document.getElementById("textSpeedToggle");
                const textSpeeds = ["Fast", "Relaxed", "Patient"];
                const speedValues = { Fast: 500, Relaxed: 1500, Patient: 3000 };
                let currentSpeedIndex = 1; // Start with "Relaxed"

                textSpeedToggle.addEventListener("click", () => {
                    currentSpeedIndex =
                        (currentSpeedIndex + 1) % textSpeeds.length;
                    const speedName = textSpeeds[currentSpeedIndex];
                    textSpeedToggle.textContent = speedName;
                    textSpeed = speedValues[speedName];
                });

                // Contrast toggle with sun/moon icon
                const contrastToggle =
                    document.getElementById("contrastToggle");
                let isHighContrast = false;

                contrastToggle.addEventListener("click", () => {
                    isHighContrast = !isHighContrast;
                    document.body.classList.toggle(
                        "high-contrast",
                        isHighContrast,
                    );

                    // Toggle between sun and moon icons
                    if (isHighContrast) {
                        contrastToggle.innerHTML = `
                            <svg viewBox="0 0 24 24" fill="currentColor" stroke="none">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                            </svg>
                        `;
                    } else {
                        contrastToggle.innerHTML = `
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="5"/>
                                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                            </svg>
                        `;
                    }
                });
            }

            function startDrag(e) {
                if (
                    e.target.classList.contains("point") ||
                    e.target.closest(".dialogue-panel")
                )
                    return;
                isDragging = true;
                container.classList.add("dragging");
                startX = e.clientX - currentX;
                startY = e.clientY - currentY;
            }

            function startDragTouch(e) {
                if (
                    e.target.classList.contains("point") ||
                    e.target.closest(".dialogue-panel")
                )
                    return;
                isDragging = true;
                container.classList.add("dragging");
                const touch = e.touches[0];
                startX = touch.clientX - currentX;
                startY = touch.clientY - currentY;
            }

            function drag(e) {
                if (!isDragging) return;
                e.preventDefault();
                currentX = e.clientX - startX;
                currentY = e.clientY - startY;
                updateBackgroundPosition();
            }

            function dragTouch(e) {
                if (!isDragging) return;
                e.preventDefault();
                const touch = e.touches[0];
                currentX = touch.clientX - startX;
                currentY = touch.clientY - startY;
                updateBackgroundPosition();
            }

            function endDrag() {
                isDragging = false;
                container.classList.remove("dragging");
            }

            function updateBackgroundPosition() {
                const maxX = window.innerWidth * 0.1;
                const maxY = window.innerHeight * 0.1;
                currentX = Math.max(-maxX, Math.min(maxX, currentX));
                currentY = Math.max(-maxY, Math.min(maxY, currentY));
                backgroundContainer.style.transform = `translate(${currentX}px, ${currentY}px)`;
                updatePointPositions();
            }

            function updatePointPositions() {
                const containerRect = container.getBoundingClientRect();
                const bgRect = backgroundContainer.getBoundingClientRect();

                storyPoints.forEach((point, index) => {
                    const pointElement = pointElements[index];
                    if (pointElement) {
                        const x = bgRect.left + (bgRect.width * point.x) / 100;
                        const y = bgRect.top + (bgRect.height * point.y) / 100;
                        pointElement.style.left = x + "px";
                        pointElement.style.top = y + "px";
                    }
                });
            }

            function showDialogue(point, pointElement) {
                currentStoryPoint = point;
                locationTitle.textContent = point.title;
                locationSubtitle.textContent = point.subtitle;

                // Update selected state
                pointElements.forEach((el) => el.classList.remove("selected"));
                pointElement.classList.add("selected");

                // Show first section
                showSection(point, 0);
            }

            function showSection(point, sectionIndex) {
                const section = point.sections[sectionIndex];

                // Clear container
                dialogueTextContainer.innerHTML = "";

                // Create dialogue entry
                const dialogueEntry = document.createElement("div");
                dialogueEntry.className = "dialogue-entry";

                const speaker = document.createElement("div");
                speaker.className = "dialogue-speaker";
                speaker.textContent = section.speaker;
                dialogueEntry.appendChild(speaker);

                // Split text into sentences/paragraphs and animate them one by one using textSpeed
                const sentences = section.text
                    .split(/(?<=[.!?])\s+/)
                    .filter((s) => s.trim().length > 0);

                sentences.forEach((sentence, index) => {
                    const paragraphElement = document.createElement("div");
                    paragraphElement.className = "section-text";
                    paragraphElement.textContent = sentence.trim();
                    paragraphElement.style.opacity = "0";
                    paragraphElement.style.transform = "translateY(10px)";
                    paragraphElement.style.transition =
                        "opacity 0.6s ease, transform 0.6s ease";

                    dialogueEntry.appendChild(paragraphElement);

                    // Show each paragraph with delay based on textSpeed
                    setTimeout(() => {
                        paragraphElement.style.opacity = "1";
                        paragraphElement.style.transform = "translateY(0)";
                    }, index * textSpeed);
                });

                dialogueTextContainer.appendChild(dialogueEntry);

                // Update options - filter out the selected option
                dialogueOptions.innerHTML = "";
                point.options.forEach((option, index) => {
                    // Skip the option that was just selected (except close option)
                    if (
                        option.section === sectionIndex &&
                        option.action !== "close"
                    ) {
                        return;
                    }

                    const optionButton = document.createElement("button");
                    optionButton.className = "dialogue-option";

                    // Renumber the remaining options
                    const remainingOptions = point.options.filter(
                        (opt, idx) =>
                            opt.action === "close" ||
                            opt.section !== sectionIndex,
                    );
                    const newIndex = remainingOptions.indexOf(option) + 1;

                    optionButton.innerHTML = `<span class="option-number">${newIndex}.</span>${option.text}`;

                    if (option.action === "close") {
                        optionButton.addEventListener("click", () =>
                            hideDialogue(),
                        );
                    } else if (option.section !== undefined) {
                        optionButton.addEventListener("click", () =>
                            showSection(point, option.section),
                        );
                    }

                    dialogueOptions.appendChild(optionButton);
                });

                dialoguePanel.classList.add("visible");
                dialogueTextContainer.scrollTop = 0;
            }

            function hideDialogue() {
                dialoguePanel.classList.remove("visible");
                pointElements.forEach((el) => el.classList.remove("selected"));
            }

            function showWelcomeMessage() {
                currentStoryPoint = null; // Ensure intro popup can be auto-closed
                setTimeout(() => dialoguePanel.classList.add("visible"), 800);
            }

            window.addEventListener("load", initialize);
        </script>
    </body>
</html>
